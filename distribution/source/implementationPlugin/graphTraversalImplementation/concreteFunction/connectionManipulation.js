"use strict";
let x = {






  async filterAndOrderChildren({ insertionPointKey, children = this.children }) {
    let ownFilteredChildren = await this.filterAndModifyChildrenArray(children, insertionPointKey, null);
    let additionalFilteredChildren = await this.filterAndModifyChildrenArray(this.additionalChildNestedUnit, insertionPointKey, this.pathPointerKey);
    let merged = await this.mergeAndOrderChildren(ownFilteredChildren, additionalFilteredChildren);
    return merged;
  },






  async filterAndModifyChildrenArray(children, insertionPointKey, pathPointerKey) {
    return children.filter((child, index) => {

      let result = child.insertionPosition.insertionPoint == insertionPointKey && child.insertionPosition.insertionPathPointer == pathPointerKey;

      return result;
    });
  },

  async mergeAndOrderChildren(ownFilteredChildren, additionalFilteredChildren) {



    let firstChildren = [],
    lastChildren = [],
    orderedChildren = [];
    await additionalFilteredChildren.sort((prior, subsequent) => {
      return prior.order <= subsequent.order ? 1 : -1;
    });
    await ownFilteredChildren.sort((prior, subsequent) => {
      return prior.order <= subsequent.order ? 1 : -1;
    });


    additionalFilteredChildren = additionalFilteredChildren.filter((child, index) => {

      if (!child.insertionPosition.placement.pathPointer && child.insertionPosition.placement.type) {
        switch (child.insertionPosition.placement.type) {
          case 'before':
            firstChildren.push(child);
            break;
          case 'after':
          default:
            lastChildren.push(child);
            break;}

        return false;

      }
      return true;
    });


    ownFilteredChildren.map((ownChild, ownChildIndex) => {
      orderedChildren.push(ownChild);
      let currentChildPosition = orderedChildren.length - 1;
      additionalFilteredChildren.map((additionalChild, additionalChildIndex) => {
        if (
        additionalChild.insertionPosition.placement.type &&
        additionalChild.insertionPosition.placement.pathPointer &&
        additionalChild.insertionPosition.placement.pathPointer == ownChild.pathPointerKey)
        {
          switch (additionalChild.insertionPosition.placement.type) {
            case 'before':
              orderedChildren.splice(currentChildPosition, 0, additionalChild);
              break;
            case 'after':
            default:
              orderedChildren.splice(currentChildPosition + 1, 0, additionalChild);
              break;}

        }
      });
    });

    return Array.prototype.concat(firstChildren, orderedChildren, lastChildren);
  },
  async addAdditionalChildNestedUnit({ nestedUnit }) {

    if (nestedUnit.children.length != 0) {
      await Array.prototype.push.apply(nestedUnit.children, nestedUnit.additionalChildNestedUnit);
    } else {
      nestedUnit.children = await nestedUnit.additionalChildNestedUnit.slice();
    }
  } };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NvdXJjZS9pbXBsZW1lbnRhdGlvblBsdWdpbi9ncmFwaFRyYXZlcnNhbEltcGxlbWVudGF0aW9uL2NvbmNyZXRlRnVuY3Rpb24vY29ubmVjdGlvbk1hbmlwdWxhdGlvbi5qcyJdLCJuYW1lcyI6WyJ4IiwiZmlsdGVyQW5kT3JkZXJDaGlsZHJlbiIsImluc2VydGlvblBvaW50S2V5IiwiY2hpbGRyZW4iLCJvd25GaWx0ZXJlZENoaWxkcmVuIiwiZmlsdGVyQW5kTW9kaWZ5Q2hpbGRyZW5BcnJheSIsImFkZGl0aW9uYWxGaWx0ZXJlZENoaWxkcmVuIiwiYWRkaXRpb25hbENoaWxkTmVzdGVkVW5pdCIsInBhdGhQb2ludGVyS2V5IiwibWVyZ2VkIiwibWVyZ2VBbmRPcmRlckNoaWxkcmVuIiwiZmlsdGVyIiwiY2hpbGQiLCJpbmRleCIsInJlc3VsdCIsImluc2VydGlvblBvc2l0aW9uIiwiaW5zZXJ0aW9uUG9pbnQiLCJpbnNlcnRpb25QYXRoUG9pbnRlciIsImZpcnN0Q2hpbGRyZW4iLCJsYXN0Q2hpbGRyZW4iLCJvcmRlcmVkQ2hpbGRyZW4iLCJzb3J0IiwicHJpb3IiLCJzdWJzZXF1ZW50Iiwib3JkZXIiLCJwbGFjZW1lbnQiLCJwYXRoUG9pbnRlciIsInR5cGUiLCJwdXNoIiwibWFwIiwib3duQ2hpbGQiLCJvd25DaGlsZEluZGV4IiwiY3VycmVudENoaWxkUG9zaXRpb24iLCJsZW5ndGgiLCJhZGRpdGlvbmFsQ2hpbGQiLCJhZGRpdGlvbmFsQ2hpbGRJbmRleCIsInNwbGljZSIsIkFycmF5IiwicHJvdG90eXBlIiwiY29uY2F0IiwiYWRkQWRkaXRpb25hbENoaWxkTmVzdGVkVW5pdCIsIm5lc3RlZFVuaXQiLCJhcHBseSIsInNsaWNlIl0sIm1hcHBpbmdzIjoiO0FBQ0EsSUFBSUEsQ0FBQyxHQUFHOzs7Ozs7O0FBT04sUUFBTUMsc0JBQU4sQ0FBNkIsRUFBRUMsaUJBQUYsRUFBcUJDLFFBQVEsR0FBRyxLQUFLQSxRQUFyQyxF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dFxubGV0IHggPSB7XG4gIC8qKlxuICAgKiBAZGVzY3JpcHRpb24gZmlsdGVycyAmIG1vZGlmaWVzIGFycmF5IGJ5IHJlbW92aW5nIHRydXRoeSBpbmRleGVzLlxuICAgKlxuICAgKiBAcGFyYW0ge2FueX0ge2luc2VydGlvblBvaW50S2V5LCBpbnNlcnRpb25QYXRoID0gbnVsbH1cbiAgICogQHJldHVybnNcbiAgICovXG4gIGFzeW5jIGZpbHRlckFuZE9yZGVyQ2hpbGRyZW4oeyBpbnNlcnRpb25Qb2ludEtleSwgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuIH0pIHtcbiAgICBsZXQgb3duRmlsdGVyZWRDaGlsZHJlbiA9IGF3YWl0IHRoaXMuZmlsdGVyQW5kTW9kaWZ5Q2hpbGRyZW5BcnJheShjaGlsZHJlbiwgaW5zZXJ0aW9uUG9pbnRLZXksIG51bGwpXG4gICAgbGV0IGFkZGl0aW9uYWxGaWx0ZXJlZENoaWxkcmVuID0gYXdhaXQgdGhpcy5maWx0ZXJBbmRNb2RpZnlDaGlsZHJlbkFycmF5KHRoaXMuYWRkaXRpb25hbENoaWxkTmVzdGVkVW5pdCwgaW5zZXJ0aW9uUG9pbnRLZXksIHRoaXMucGF0aFBvaW50ZXJLZXkpXG4gICAgbGV0IG1lcmdlZCA9IGF3YWl0IHRoaXMubWVyZ2VBbmRPcmRlckNoaWxkcmVuKG93bkZpbHRlcmVkQ2hpbGRyZW4sIGFkZGl0aW9uYWxGaWx0ZXJlZENoaWxkcmVuKVxuICAgIHJldHVybiBtZXJnZWRcbiAgfSxcbiAgLyoqXG4gICAqIEdldCBjaGlsZHJlbiBjb3JyZXNwb25kaW5nIHRvIHRoZSBjdXJyZW50IGluc2VydGlvbiBwb2ludC5cbiAgICogLy8gVGFrZSBpbnRvIGNvbnNpZGVyYXRpb24gdGhlIGluZGlyZWN0IGNoaWxkcmVuIGFkZGVkIGZyb20gcHJldmlvdXMgKGluaGVyZXRlZCkgdHJlZXMuXG4gICAqIC8vIGZpbHRlcmVkVHJlZUNoaWxkcmVuICsgaW1tZWRpYXRlTmV4dENoaWxkcmVuXG4gICAqIC8vIGxldCBuZXh0Q2hpbGRyZW47XG4gICAqL1xuICBhc3luYyBmaWx0ZXJBbmRNb2RpZnlDaGlsZHJlbkFycmF5KGNoaWxkcmVuLCBpbnNlcnRpb25Qb2ludEtleSwgcGF0aFBvaW50ZXJLZXkpIHtcbiAgICByZXR1cm4gY2hpbGRyZW4uZmlsdGVyKChjaGlsZCwgaW5kZXgpID0+IHtcbiAgICAgIC8vIGZpbHRlciBjaGlsZHJlbiB0aGF0IGNvcnJlc3BvbnQgdG8gdGhlIGN1cnJlbnQgaW5zZXJ0aW9ucG9pbnQuXG4gICAgICBsZXQgcmVzdWx0ID0gY2hpbGQuaW5zZXJ0aW9uUG9zaXRpb24uaW5zZXJ0aW9uUG9pbnQgPT0gaW5zZXJ0aW9uUG9pbnRLZXkgJiYgY2hpbGQuaW5zZXJ0aW9uUG9zaXRpb24uaW5zZXJ0aW9uUGF0aFBvaW50ZXIgPT0gcGF0aFBvaW50ZXJLZXlcbiAgICAgIC8vIGlmIChyZXN1bHQpIGNoaWxkcmVuLnNwbGljZShpbmRleCwgMSk7IC8vIHdhcyBtZW50IHRvIGluY3JlYXNlIHRoZSBwZXJmb3JtYW5jZSBvZiB0aGUgcHJvZ3JhbSwgcHJldmVudGluZyByZWNoZWNraW5nIG9mIGFscmVhZHkgY2hlY2tlZCBhcnJheSBpdGVtcy4gQnV0IGl0IGNhdXNlcyBzb21lIGlzc3Vlcy5cbiAgICAgIHJldHVybiByZXN1bHRcbiAgICB9KVxuICB9LFxuICAvLyBvcmRlciBhZGRpdGlvbmFsIGNoaWxkcmVuIHRoYXQgd2lsbCBiZSBtaXhlZCBpbnRvIG93bkNoaWxkcmVuLiBBY2NvcmRpbmcgdG8gYSBzZXR0aW5nIHRoYXQgbmVlZHMgdG8gYmUgYWRkZWQgaW50byBlYWNoIGNoaWxkIG9iamVjdC5cbiAgYXN5bmMgbWVyZ2VBbmRPcmRlckNoaWxkcmVuKG93bkZpbHRlcmVkQ2hpbGRyZW4sIGFkZGl0aW9uYWxGaWx0ZXJlZENoaWxkcmVuKSB7XG4gICAgLy8gbWV0cmdlIDIgYXJyYXlzLiwgYXBwZW5kaW5nIG9uZSB0byB0aGUgb3RoZXIuXG4gICAgLy8gbGV0IGZpbHRlcmVkQ2hpbGRyZW4gPSBbXVxuICAgIC8vIGF3YWl0IEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KGZpbHRlcmVkQ2hpbGRyZW4sIG93bkZpbHRlcmVkQ2hpbGRyZW4sIGFkZGl0aW9uYWxGaWx0ZXJlZENoaWxkcmVuKTtcbiAgICBsZXQgZmlyc3RDaGlsZHJlbiA9IFtdLFxuICAgICAgbGFzdENoaWxkcmVuID0gW10sXG4gICAgICBvcmRlcmVkQ2hpbGRyZW4gPSBbXVxuICAgIGF3YWl0IGFkZGl0aW9uYWxGaWx0ZXJlZENoaWxkcmVuLnNvcnQoKHByaW9yLCBzdWJzZXF1ZW50KSA9PiB7XG4gICAgICByZXR1cm4gcHJpb3Iub3JkZXIgPD0gc3Vic2VxdWVudC5vcmRlciA/IDEgOiAtMVxuICAgIH0pXG4gICAgYXdhaXQgb3duRmlsdGVyZWRDaGlsZHJlbi5zb3J0KChwcmlvciwgc3Vic2VxdWVudCkgPT4ge1xuICAgICAgcmV0dXJuIHByaW9yLm9yZGVyIDw9IHN1YnNlcXVlbnQub3JkZXIgPyAxIDogLTFcbiAgICB9KVxuXG4gICAgLy8gZmlsdGVyIGNoaWxkcmVuIHRoYXQgY29ycmVzcG9udCB0byB0aGUgY3VycmVudCBpbnNlcnRpb25wb2ludC5cbiAgICBhZGRpdGlvbmFsRmlsdGVyZWRDaGlsZHJlbiA9IGFkZGl0aW9uYWxGaWx0ZXJlZENoaWxkcmVuLmZpbHRlcigoY2hpbGQsIGluZGV4KSA9PiB7XG4gICAgICAvLyBkZWZhdWx0IGZhbGxiYWNrIGlzIHRvIGFkZCB0aGUgY2hpbGQgdG8gdGhlIGJlZ2lubmluZy9lbmQgb2YgdGhlIGFycmF5LCBpbiBjYXNlIG5vIHBhdGhQb2ludGVyS2V5IGlzIHNwZWNpZmllZCAocGF0aFBvaW50ZXJLZXkgZGVjaWRlcyB3aGljaCBub2RlIHRvIHBsYWNlIHRoZSBjaGlsZCByZWxhdGl2ZSB0bykuXG4gICAgICBpZiAoIWNoaWxkLmluc2VydGlvblBvc2l0aW9uLnBsYWNlbWVudC5wYXRoUG9pbnRlciAmJiBjaGlsZC5pbnNlcnRpb25Qb3NpdGlvbi5wbGFjZW1lbnQudHlwZSkge1xuICAgICAgICBzd2l0Y2ggKGNoaWxkLmluc2VydGlvblBvc2l0aW9uLnBsYWNlbWVudC50eXBlKSB7XG4gICAgICAgICAgY2FzZSAnYmVmb3JlJzpcbiAgICAgICAgICAgIGZpcnN0Q2hpbGRyZW4ucHVzaChjaGlsZClcbiAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgY2FzZSAnYWZ0ZXInOlxuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICBsYXN0Q2hpbGRyZW4ucHVzaChjaGlsZClcbiAgICAgICAgICAgIGJyZWFrXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICAgIC8vIGFkZGl0aW9uYWxGaWx0ZXJlZENoaWxkcmVuLnNwbGljZShpbmRleCwgMSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0pXG5cbiAgICAvLyBpbnNlcnQgYWRkaXRpb25hbCBjaGlsZCBpZiBpdCBtYXRjaGVzIGN1cnJlbnQgY2hpbGQgcGF0aCBwb2ludGVyIGtleS5cbiAgICBvd25GaWx0ZXJlZENoaWxkcmVuLm1hcCgob3duQ2hpbGQsIG93bkNoaWxkSW5kZXgpID0+IHtcbiAgICAgIG9yZGVyZWRDaGlsZHJlbi5wdXNoKG93bkNoaWxkKSAvLyBhZGQgY2hpbGQgdG8gb3JkZXJlZCBhcnJheVxuICAgICAgbGV0IGN1cnJlbnRDaGlsZFBvc2l0aW9uID0gb3JkZXJlZENoaWxkcmVuLmxlbmd0aCAtIDEgLy8gbGFzdCBhcnJheSBpdGVtIGluZGV4LlxuICAgICAgYWRkaXRpb25hbEZpbHRlcmVkQ2hpbGRyZW4ubWFwKChhZGRpdGlvbmFsQ2hpbGQsIGFkZGl0aW9uYWxDaGlsZEluZGV4KSA9PiB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICBhZGRpdGlvbmFsQ2hpbGQuaW5zZXJ0aW9uUG9zaXRpb24ucGxhY2VtZW50LnR5cGUgJiZcbiAgICAgICAgICBhZGRpdGlvbmFsQ2hpbGQuaW5zZXJ0aW9uUG9zaXRpb24ucGxhY2VtZW50LnBhdGhQb2ludGVyICYmXG4gICAgICAgICAgYWRkaXRpb25hbENoaWxkLmluc2VydGlvblBvc2l0aW9uLnBsYWNlbWVudC5wYXRoUG9pbnRlciA9PSBvd25DaGlsZC5wYXRoUG9pbnRlcktleVxuICAgICAgICApIHtcbiAgICAgICAgICBzd2l0Y2ggKGFkZGl0aW9uYWxDaGlsZC5pbnNlcnRpb25Qb3NpdGlvbi5wbGFjZW1lbnQudHlwZSkge1xuICAgICAgICAgICAgY2FzZSAnYmVmb3JlJzpcbiAgICAgICAgICAgICAgb3JkZXJlZENoaWxkcmVuLnNwbGljZShjdXJyZW50Q2hpbGRQb3NpdGlvbiwgMCwgYWRkaXRpb25hbENoaWxkKSAvLyBpbnNlcnQgYmVmb3JlIGN1cnJlbnRQb3NpdGlvblxuICAgICAgICAgICAgICBicmVha1xuICAgICAgICAgICAgY2FzZSAnYWZ0ZXInOlxuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgb3JkZXJlZENoaWxkcmVuLnNwbGljZShjdXJyZW50Q2hpbGRQb3NpdGlvbiArIDEsIDAsIGFkZGl0aW9uYWxDaGlsZCkgLy8gaW5zZXJ0IGFmdGVyIGN1cnJlbnRQb3NpdGlvbi5cbiAgICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfSlcblxuICAgIHJldHVybiBBcnJheS5wcm90b3R5cGUuY29uY2F0KGZpcnN0Q2hpbGRyZW4sIG9yZGVyZWRDaGlsZHJlbiwgbGFzdENoaWxkcmVuKVxuICB9LFxuICBhc3luYyBhZGRBZGRpdGlvbmFsQ2hpbGROZXN0ZWRVbml0KHsgbmVzdGVkVW5pdCB9KSB7XG4gICAgLy8gQWRkIHRoZSByZXN0IG9mIHRoZSBpbW1lZGlhdGUgY2hpbGRyZW4gdG8gdGhlIG5leHQgdHJlZSBhcyBhZGRpdGlvbmFsIGNoaWxkcmVuLiBwcm9wYWdhdGUgY2hpbGRyZW4gdG8gdGhlIG5leHQgdHJlZS5cbiAgICBpZiAobmVzdGVkVW5pdC5jaGlsZHJlbi5sZW5ndGggIT0gMCkge1xuICAgICAgYXdhaXQgQXJyYXkucHJvdG90eXBlLnB1c2guYXBwbHkobmVzdGVkVW5pdC5jaGlsZHJlbiwgbmVzdGVkVW5pdC5hZGRpdGlvbmFsQ2hpbGROZXN0ZWRVbml0KVxuICAgIH0gZWxzZSB7XG4gICAgICBuZXN0ZWRVbml0LmNoaWxkcmVuID0gYXdhaXQgbmVzdGVkVW5pdC5hZGRpdGlvbmFsQ2hpbGROZXN0ZWRVbml0LnNsaWNlKClcbiAgICB9XG4gIH0sXG59XG4iXX0=