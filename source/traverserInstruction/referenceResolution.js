"use strict";Object.defineProperty(exports, "__esModule", { value: true });exports.resolveReference = resolveReference;exports.selectionReferenceResolution = selectionReferenceResolution;exports.conditionSwitchResolution = conditionSwitchResolution;var _concreteDatabaseWrapper = require("../dataModel/concreteDatabaseWrapper.js");

const emptyStageNode = {
  identity: -1,
  labels: ['Stage'],
  properties: {
    key: null } };




async function resolveReference({ targetNode, graph, traverseCallContext }) {
  const { reference } = await graph.databaseWrapper.getReferenceResolutionElement({ concreteDatabase: graph.database, nodeID: targetNode.identity });
  if (!reference) return;


  if ((0, _concreteDatabaseWrapper.isSelfEdge)(reference)) {

    let labelIndex = reference.destination.labels.indexOf(targetNode.entrypointNodeType);
    reference.destination.labels[labelIndex] += `-ignore`;
  }

  let resolvedNode;
  switch (reference.connection.properties.resolutionImplementation) {
    case 'selection':
      resolvedNode = await graph.traverserInstruction.referenceResolution.selectionReferenceResolution({ graph, targetNode: reference.destination, traverseCallContext });
      break;
    case 'node':
    default:
      resolvedNode = reference.destination;
      break;}


  return resolvedNode;
}





async function selectionReferenceResolution({ graph, targetNode, traverseCallContext }) {
  let resolvedReferenceNode;
  const { selectArray, fallback: fallbackRelationship } = await graph.databaseWrapper.getSelectionElement({ concreteDatabase: graph.database, nodeID: targetNode.identity });
  selectArray.sort((former, latter) => former.connection.properties.order - latter.connection.properties.order);



  let index = 0;
  while (selectArray.length > index && !resolvedReferenceNode) {
    resolvedReferenceNode = await graph.traverserInstruction.referenceResolution.conditionSwitchResolution({ graph, targetNode: selectArray[index].destination, traverseCallContext });
    index++;
  }


  resolvedReferenceNode || (resolvedReferenceNode = (fallbackRelationship === null || fallbackRelationship === void 0 ? void 0 : fallbackRelationship.destination) || emptyStageNode);
  return resolvedReferenceNode;
}





async function conditionSwitchResolution({ graph, targetNode, traverseCallContext }) {
  let matchingNode;
  const { caseArray } = await graph.databaseWrapper.getConditionSwitchElement({ concreteDatabase: graph.database, nodeID: targetNode.identity });
  let value = await graph.traverserInstruction.valueResolution.resolveValue({ targetNode: targetNode, graph, traverseCallContext, allowSelfEdge: true });

  if (caseArray) {

    let caseRelationship = caseArray.filter(caseRelationship => {var _caseRelationship$con;return ((_caseRelationship$con = caseRelationship.connection.properties) === null || _caseRelationship$con === void 0 ? void 0 : _caseRelationship$con.expected) == value;})[0];
    matchingNode = caseRelationship === null || caseRelationship === void 0 ? void 0 : caseRelationship.destination;
  }
  return matchingNode || null;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NvdXJjZS90cmF2ZXJzZXJJbnN0cnVjdGlvbi9yZWZlcmVuY2VSZXNvbHV0aW9uLmpzIl0sIm5hbWVzIjpbImVtcHR5U3RhZ2VOb2RlIiwiaWRlbnRpdHkiLCJsYWJlbHMiLCJwcm9wZXJ0aWVzIiwia2V5IiwicmVzb2x2ZVJlZmVyZW5jZSIsInRhcmdldE5vZGUiLCJncmFwaCIsInRyYXZlcnNlQ2FsbENvbnRleHQiLCJyZWZlcmVuY2UiLCJkYXRhYmFzZVdyYXBwZXIiLCJnZXRSZWZlcmVuY2VSZXNvbHV0aW9uRWxlbWVudCIsImNvbmNyZXRlRGF0YWJhc2UiLCJkYXRhYmFzZSIsIm5vZGVJRCIsImxhYmVsSW5kZXgiLCJkZXN0aW5hdGlvbiIsImluZGV4T2YiLCJlbnRyeXBvaW50Tm9kZVR5cGUiLCJyZXNvbHZlZE5vZGUiLCJjb25uZWN0aW9uIiwicmVzb2x1dGlvbkltcGxlbWVudGF0aW9uIiwidHJhdmVyc2VySW5zdHJ1Y3Rpb24iLCJyZWZlcmVuY2VSZXNvbHV0aW9uIiwic2VsZWN0aW9uUmVmZXJlbmNlUmVzb2x1dGlvbiIsInJlc29sdmVkUmVmZXJlbmNlTm9kZSIsInNlbGVjdEFycmF5IiwiZmFsbGJhY2siLCJmYWxsYmFja1JlbGF0aW9uc2hpcCIsImdldFNlbGVjdGlvbkVsZW1lbnQiLCJzb3J0IiwiZm9ybWVyIiwibGF0dGVyIiwib3JkZXIiLCJpbmRleCIsImxlbmd0aCIsImNvbmRpdGlvblN3aXRjaFJlc29sdXRpb24iLCJtYXRjaGluZ05vZGUiLCJjYXNlQXJyYXkiLCJnZXRDb25kaXRpb25Td2l0Y2hFbGVtZW50IiwidmFsdWUiLCJ2YWx1ZVJlc29sdXRpb24iLCJyZXNvbHZlVmFsdWUiLCJhbGxvd1NlbGZFZGdlIiwiY2FzZVJlbGF0aW9uc2hpcCIsImZpbHRlciIsImV4cGVjdGVkIl0sIm1hcHBpbmdzIjoieVBBQUE7O0FBRUEsTUFBTUEsY0FBYyxHQUFHO0FBQ3JCQyxFQUFBQSxRQUFRLEVBQUUsQ0FBQyxDQURV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QixLQUFGLEVBQVNELFVBQVQsRUFBcUJFLG1CQUFyQixFQUF6QyxFQUFxRjtBQUMxRixNQUFJNkIsWUFBSjtBQUNBLFFBQU0sRUFBRUMsU0FBRixLQUFnQixNQUFNL0IsS0FBSyxDQUFDRyxlQUFOLENBQXNCNkIseUJBQXRCLENBQWdELEVBQUUzQixnQkFBZ0IsRUFBRUwsS0FBSyxDQUFDTSxRQUExQixFQUFvQ0MsTUFBTSxFQUFFUixVQUFVLENBQUNMLFFBQXZELEVBQWhELENBQTVCO0FBQ0EsTUFBSXVDLEtBQUssR0FBRyxNQUFNakMsS0FBSyxDQUFDZSxvQkFBTixDQUEyQm1CLGVBQTNCLENBQTJDQyxZQUEzQyxDQUF3RCxFQUFFcEMsVUFBVSxFQUFFQSxVQUFkLEVBQTBCQyxLQUExQixFQUFpQ0MsbUJBQWpDLEVBQXNEbUMsYUFBYSxFQUFFLElBQXJFLEVBQXhELENBQWxCOztBQUVBLE1BQUlMLFNBQUosRUFBZTs7QUFFYixRQUFJTSxnQkFBZ0IsR0FBR04sU0FBUyxDQUFDTyxNQUFWLENBQWlCRCxnQkFBZ0Isc0NBQUksMEJBQUFBLGdCQUFnQixDQUFDeEIsVUFBakIsQ0FBNEJqQixVQUE1QixnRkFBd0MyQyxRQUF4QyxLQUFvRE4sS0FBeEQsRUFBakMsRUFBZ0csQ0FBaEcsQ0FBdkI7QUFDQUgsSUFBQUEsWUFBWSxHQUFHTyxnQkFBSCxhQUFHQSxnQkFBSCx1QkFBR0EsZ0JBQWdCLENBQUU1QixXQUFqQztBQUNEO0FBQ0QsU0FBT3FCLFlBQVksSUFBSSxJQUF2QjtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgaXNTZWxmRWRnZSB9IGZyb20gJy4uL2RhdGFNb2RlbC9jb25jcmV0ZURhdGFiYXNlV3JhcHBlci5qcydcbi8vIEZhbGxiYWNrIG5vZGUgZm9yIHVucmVzb2x2ZWQgcmVmZXJlbmNlIHJlcm91dGUuIFRoaXMgaXMgYW4gaW1wbGljaXQgbm9kZSwgdGhhdCBkb2Vzbid0IGFjdHVhbGx5IGV4aXN0IGluIHRoZSBncmFwaC5cbmNvbnN0IGVtcHR5U3RhZ2VOb2RlID0ge1xuICBpZGVudGl0eTogLTEsXG4gIGxhYmVsczogWydTdGFnZSddLFxuICBwcm9wZXJ0aWVzOiB7XG4gICAga2V5OiBudWxsLFxuICB9LFxufVxuXG4vLyBSZXNvbHV0aW9uIG9mIHJlZmVyZW5jZSBub2RlIHVzaW5nIGRpZmZlcmVudCBtZWNoYW5pc21zLlxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJlc29sdmVSZWZlcmVuY2UoeyB0YXJnZXROb2RlLCBncmFwaCwgdHJhdmVyc2VDYWxsQ29udGV4dCB9KSB7XG4gIGNvbnN0IHsgcmVmZXJlbmNlIH0gPSBhd2FpdCBncmFwaC5kYXRhYmFzZVdyYXBwZXIuZ2V0UmVmZXJlbmNlUmVzb2x1dGlvbkVsZW1lbnQoeyBjb25jcmV0ZURhdGFiYXNlOiBncmFwaC5kYXRhYmFzZSwgbm9kZUlEOiB0YXJnZXROb2RlLmlkZW50aXR5IH0pXG4gIGlmICghcmVmZXJlbmNlKSByZXR1cm5cblxuICAvLyBwcmV2ZW50IGNpcmN1bGFyIHRyYXZlcnNhbCwgaW4gY2FzZSBtdWx0aXBsZSB0eXBlcyBhcmUgdXNlZCBmb3IgdGhlIHNhbWUgbm9kZSBhbmQgdGhlIHJlZmVyZW5jZSBlZGdlIGlzIHNlbGYgZWRnZTpcbiAgaWYgKGlzU2VsZkVkZ2UocmVmZXJlbmNlKSkge1xuICAgIC8vIHdvcmthcm91bmQgaXMgdG8gcmVtb3ZlIHRoZSBSZXJvdXRlIHR5cGUgZnJvbSB0aGUgbGFiZWxzIGFycmF5LiBUT0RPOiBjb25zaWRlciBhbGxvd2luZyBhIHBhcmFtZXRlciB0aGF0IGNvbnRyb2xzIHdoaWNoIGVudHJ5cG9pbnQgbm9kZSBpbXBsZW1lbnRhdGlvbnMgYXJlIGlnbm9yZWQuXG4gICAgbGV0IGxhYmVsSW5kZXggPSByZWZlcmVuY2UuZGVzdGluYXRpb24ubGFiZWxzLmluZGV4T2YodGFyZ2V0Tm9kZS5lbnRyeXBvaW50Tm9kZVR5cGUpXG4gICAgcmVmZXJlbmNlLmRlc3RpbmF0aW9uLmxhYmVsc1tsYWJlbEluZGV4XSArPSBgLWlnbm9yZWAgLy8gaWdub3JlIG9uIG5leHQgdHJhdmVyc2FsIChrZWVwIHRoZSBlbnRyeSBmb3IgZGVidWdnaW5nIHB1cnBvc2VzKS5cbiAgfVxuXG4gIGxldCByZXNvbHZlZE5vZGVcbiAgc3dpdGNoIChyZWZlcmVuY2UuY29ubmVjdGlvbi5wcm9wZXJ0aWVzLnJlc29sdXRpb25JbXBsZW1lbnRhdGlvbikge1xuICAgIGNhc2UgJ3NlbGVjdGlvbic6XG4gICAgICByZXNvbHZlZE5vZGUgPSBhd2FpdCBncmFwaC50cmF2ZXJzZXJJbnN0cnVjdGlvbi5yZWZlcmVuY2VSZXNvbHV0aW9uLnNlbGVjdGlvblJlZmVyZW5jZVJlc29sdXRpb24oeyBncmFwaCwgdGFyZ2V0Tm9kZTogcmVmZXJlbmNlLmRlc3RpbmF0aW9uLCB0cmF2ZXJzZUNhbGxDb250ZXh0IH0pXG4gICAgICBicmVha1xuICAgIGNhc2UgJ25vZGUnOlxuICAgIGRlZmF1bHQ6XG4gICAgICByZXNvbHZlZE5vZGUgPSByZWZlcmVuY2UuZGVzdGluYXRpb25cbiAgICAgIGJyZWFrXG4gIH1cblxuICByZXR1cm4gcmVzb2x2ZWROb2RlXG59XG5cbi8qKlxuICogQ29udHJvbCBmbG93IHN0cnVjdHVyZSBzdXBwb3J0aW5nIGJpbmFyeSBzZWxlY2F0aW9uIChpZiBzdGF0ZW1lbnQpLCBpZiBlbHNlIGlmLCBzd2l0Y2ggY2FzZSAobXVsdGktd2F5IHNlbGVjdGlvbikuIEEgY29tYmluZWQgSWYgRWxzZSBhbmQgU3dpdGNoIENhc2UgY29uY2VwdHMuXG4gIFRPRE86IENvbnNpZGVyIHVzaW5nIFwiQ29tcGFyaXNvblwiIGFzIHRoZSBub2RlIGxhYmVsIGZvciBzZWxlY3Rpb24gZGVzdGluYXRpb25zLlxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VsZWN0aW9uUmVmZXJlbmNlUmVzb2x1dGlvbih7IGdyYXBoLCB0YXJnZXROb2RlLCB0cmF2ZXJzZUNhbGxDb250ZXh0IH0pIHtcbiAgbGV0IHJlc29sdmVkUmVmZXJlbmNlTm9kZVxuICBjb25zdCB7IHNlbGVjdEFycmF5LCBmYWxsYmFjazogZmFsbGJhY2tSZWxhdGlvbnNoaXAgfSA9IGF3YWl0IGdyYXBoLmRhdGFiYXNlV3JhcHBlci5nZXRTZWxlY3Rpb25FbGVtZW50KHsgY29uY3JldGVEYXRhYmFzZTogZ3JhcGguZGF0YWJhc2UsIG5vZGVJRDogdGFyZ2V0Tm9kZS5pZGVudGl0eSB9KVxuICBzZWxlY3RBcnJheS5zb3J0KChmb3JtZXIsIGxhdHRlcikgPT4gZm9ybWVyLmNvbm5lY3Rpb24ucHJvcGVydGllcy5vcmRlciAtIGxhdHRlci5jb25uZWN0aW9uLnByb3BlcnRpZXMub3JkZXIpIC8vIHVzaW5nIGBvcmRlcmAgcHJvcGVydHkgLy8gQnVsayBhY3Rpb25zIG9uIGZvcmtzIC0gc29ydCBmb3Jrc1xuXG4gIC8vIFRPRE86IHN1cHBvcnQgcGFyYWxsZWwgLyBwcm9taXNlLmFsbCBzZWxlY3Rpb24gLSB3aGVyZSB0aGUgZmlyc3Qgc2VsZWN0ZWQgd2lsbCBiZSByZXR1cm5lZC4gV2hlbiBTRUxFQ1QgaGFzIGFuIG9yZGVyIGl0IHdpbGwgYmUgY2hyb25vbG9naWNhbGx5IGV4ZWN1dGVkLCBidXQgdGhlIHNlbGVjdHMgdGhhdCBsYWNrIG9yZGVyIHByb3BlcnR5IHdpbGwgYmUgZXhlY3V0ZWQgd2l0aCBwcm9taXNlLmFsbFxuICAvLyBUT0RPOiBVc2Ugc2FtZSBsb2dpYyBpbiBwcm9wYWdhdGlvbiBhcyB1c2VkIGZvciBQb3J0IE5FWFQgbm9kZXMuIChjaHJvbm9sb2dpY2FsLCByYWNlRmlyc3RQcm9taXNlLCBhbGxQcm9taXNlLCBldGMuKVxuICBsZXQgaW5kZXggPSAwXG4gIHdoaWxlIChzZWxlY3RBcnJheS5sZW5ndGggPiBpbmRleCAmJiAhcmVzb2x2ZWRSZWZlcmVuY2VOb2RlKSB7XG4gICAgcmVzb2x2ZWRSZWZlcmVuY2VOb2RlID0gYXdhaXQgZ3JhcGgudHJhdmVyc2VySW5zdHJ1Y3Rpb24ucmVmZXJlbmNlUmVzb2x1dGlvbi5jb25kaXRpb25Td2l0Y2hSZXNvbHV0aW9uKHsgZ3JhcGgsIHRhcmdldE5vZGU6IHNlbGVjdEFycmF5W2luZGV4XS5kZXN0aW5hdGlvbiwgdHJhdmVyc2VDYWxsQ29udGV4dCB9KVxuICAgIGluZGV4KytcbiAgfVxuXG4gIC8vIEltcG9ydGFudDogcmVyb3V0ZSByZXNvbHV0aW9uIG11c3QgcmV0dXJuIGEgbm9kZSBldmVuIGlmIG5vIGFjdHVhbCBvbmUgd2FzIHJlc29sdmVkLiBUaGlzIHdpbGwgcHJldmVudCByZXR1cm5pbmcgYW4gdW5kZWZpbmVkIHRoYXQgd2lsbCB0aHJvdyBkdXJpbmcgYWdncmVnYXRpb24gb2YgcmVzdWx0cy4gSW5zdGVhZCByZXR1cm4gYSBTdGFnZSB0aGF0IHdpbGwgYmUgc2tpcHBlZC5cbiAgcmVzb2x2ZWRSZWZlcmVuY2VOb2RlIHx8PSBmYWxsYmFja1JlbGF0aW9uc2hpcD8uZGVzdGluYXRpb24gfHwgZW1wdHlTdGFnZU5vZGVcbiAgcmV0dXJuIHJlc29sdmVkUmVmZXJlbmNlTm9kZVxufVxuXG4vKiogcmVzb2x2ZXMgVkFMVUUgYW5kIHBpY2tzIHRoZSBtYXRjaGluZyBDQVNFIG5vZGUuXG4gICogQHBhcmFtIHRhcmdldE5vZGUgU3RhZ2Ugbm9kZSB3aXRoIFZBTFVFIGNvbm5lY3Rpb24gcmVwcmVzZW50aW5nIHRoZSBjb25kaXRpb25cblxuKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjb25kaXRpb25Td2l0Y2hSZXNvbHV0aW9uKHsgZ3JhcGgsIHRhcmdldE5vZGUsIHRyYXZlcnNlQ2FsbENvbnRleHQgfSkge1xuICBsZXQgbWF0Y2hpbmdOb2RlXG4gIGNvbnN0IHsgY2FzZUFycmF5IH0gPSBhd2FpdCBncmFwaC5kYXRhYmFzZVdyYXBwZXIuZ2V0Q29uZGl0aW9uU3dpdGNoRWxlbWVudCh7IGNvbmNyZXRlRGF0YWJhc2U6IGdyYXBoLmRhdGFiYXNlLCBub2RlSUQ6IHRhcmdldE5vZGUuaWRlbnRpdHkgfSlcbiAgbGV0IHZhbHVlID0gYXdhaXQgZ3JhcGgudHJhdmVyc2VySW5zdHJ1Y3Rpb24udmFsdWVSZXNvbHV0aW9uLnJlc29sdmVWYWx1ZSh7IHRhcmdldE5vZGU6IHRhcmdldE5vZGUsIGdyYXBoLCB0cmF2ZXJzZUNhbGxDb250ZXh0LCBhbGxvd1NlbGZFZGdlOiB0cnVlIH0pXG4gIC8vIFN3aXRjaCBjYXNlczogcmV0dXJuIGV2YWx1YXRpb24gY29uZmlndXJhdGlvblxuICBpZiAoY2FzZUFycmF5KSB7XG4gICAgLy8gY29tcGFyZSBleHBlY3RlZCB2YWx1ZSB3aXRoIHJlc3VsdFxuICAgIGxldCBjYXNlUmVsYXRpb25zaGlwID0gY2FzZUFycmF5LmZpbHRlcihjYXNlUmVsYXRpb25zaGlwID0+IGNhc2VSZWxhdGlvbnNoaXAuY29ubmVjdGlvbi5wcm9wZXJ0aWVzPy5leHBlY3RlZCA9PSB2YWx1ZSlbMF1cbiAgICBtYXRjaGluZ05vZGUgPSBjYXNlUmVsYXRpb25zaGlwPy5kZXN0aW5hdGlvblxuICB9XG4gIHJldHVybiBtYXRjaGluZ05vZGUgfHwgbnVsbFxufVxuIl19