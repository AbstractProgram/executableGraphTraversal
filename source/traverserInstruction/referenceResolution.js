"use strict";Object.defineProperty(exports, "__esModule", { value: true });exports.resolveReference = resolveReference;exports.selectionReferenceResolution = selectionReferenceResolution;exports.conditionSwitchResolution = conditionSwitchResolution;var _concreteDatabaseWrapper = require("../dataModel/concreteDatabaseWrapper.js");

const emptyStageNode = {
  identity: -1,
  labels: ['Stage'],
  properties: {
    key: null } };




async function resolveReference({ targetNode, graph, traverseCallContext }) {
  const { reference } = await graph.databaseWrapper.getReferenceResolutionElement({ concreteDatabase: graph.database, nodeID: targetNode.identity });
  if (!reference) return;


  if ((0, _concreteDatabaseWrapper.isSelfEdge)(reference)) {

    let labelIndex = reference.destination.labels.indexOf(targetNode.entrypointNodeType);
    reference.destination.labels[labelIndex] += `-ignore`;
  }

  let resolvedNode;
  switch (reference.connection.properties.resolutionImplementation) {
    case 'selection':
      resolvedNode = await graph.traverserInstruction.referenceResolution.selectionReferenceResolution({ graph, targetNode: reference.destination, traverseCallContext });
      break;
    case 'node':
    default:
      resolvedNode = reference.destination;
      break;}


  return resolvedNode;
}





async function selectionReferenceResolution({ graph, targetNode, traverseCallContext }) {
  let resolvedReferenceNode;
  const { selectArray, fallback: fallbackRelationship } = await graph.databaseWrapper.getSelectionElement({ concreteDatabase: graph.database, nodeID: targetNode.identity });

  if (selectArray) {
    selectArray.sort(
    (former, latter) => former.connection.properties.order - latter.connection.properties.order || isNaN(former.connection.properties.order) - isNaN(latter.connection.properties.order));




    let index = 0;
    while (selectArray.length > index && !resolvedReferenceNode) {
      resolvedReferenceNode = await graph.traverserInstruction.referenceResolution.conditionSwitchResolution({ graph, targetNode: selectArray[index].destination, traverseCallContext });
      index++;
    }
  }


  resolvedReferenceNode || (resolvedReferenceNode = (fallbackRelationship === null || fallbackRelationship === void 0 ? void 0 : fallbackRelationship.destination) || emptyStageNode);
  return resolvedReferenceNode;
}





async function conditionSwitchResolution({ graph, targetNode, traverseCallContext }) {
  let matchingNode;
  const { caseArray } = await graph.databaseWrapper.getConditionSwitchElement({ concreteDatabase: graph.database, nodeID: targetNode.identity });
  let value = await graph.traverserInstruction.valueResolution.resolveValue({ targetNode: targetNode, graph, traverseCallContext, allowSelfEdge: true });

  if (caseArray) {

    let caseRelationship = caseArray.filter(caseRelationship => {var _caseRelationship$con;return ((_caseRelationship$con = caseRelationship.connection.properties) === null || _caseRelationship$con === void 0 ? void 0 : _caseRelationship$con.expected) == value;})[0];
    matchingNode = caseRelationship === null || caseRelationship === void 0 ? void 0 : caseRelationship.destination;
  }
  return matchingNode || null;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NvdXJjZS90cmF2ZXJzZXJJbnN0cnVjdGlvbi9yZWZlcmVuY2VSZXNvbHV0aW9uLmpzIl0sIm5hbWVzIjpbImVtcHR5U3RhZ2VOb2RlIiwiaWRlbnRpdHkiLCJsYWJlbHMiLCJwcm9wZXJ0aWVzIiwia2V5IiwicmVzb2x2ZVJlZmVyZW5jZSIsInRhcmdldE5vZGUiLCJncmFwaCIsInRyYXZlcnNlQ2FsbENvbnRleHQiLCJyZWZlcmVuY2UiLCJkYXRhYmFzZVdyYXBwZXIiLCJnZXRSZWZlcmVuY2VSZXNvbHV0aW9uRWxlbWVudCIsImNvbmNyZXRlRGF0YWJhc2UiLCJkYXRhYmFzZSIsIm5vZGVJRCIsImxhYmVsSW5kZXgiLCJkZXN0aW5hdGlvbiIsImluZGV4T2YiLCJlbnRyeXBvaW50Tm9kZVR5cGUiLCJyZXNvbHZlZE5vZGUiLCJjb25uZWN0aW9uIiwicmVzb2x1dGlvbkltcGxlbWVudGF0aW9uIiwidHJhdmVyc2VySW5zdHJ1Y3Rpb24iLCJyZWZlcmVuY2VSZXNvbHV0aW9uIiwic2VsZWN0aW9uUmVmZXJlbmNlUmVzb2x1dGlvbiIsInJlc29sdmVkUmVmZXJlbmNlTm9kZSIsInNlbGVjdEFycmF5IiwiZmFsbGJhY2siLCJmYWxsYmFja1JlbGF0aW9uc2hpcCIsImdldFNlbGVjdGlvbkVsZW1lbnQiLCJzb3J0IiwiZm9ybWVyIiwibGF0dGVyIiwib3JkZXIiLCJpc05hTiIsImluZGV4IiwibGVuZ3RoIiwiY29uZGl0aW9uU3dpdGNoUmVzb2x1dGlvbiIsIm1hdGNoaW5nTm9kZSIsImNhc2VBcnJheSIsImdldENvbmRpdGlvblN3aXRjaEVsZW1lbnQiLCJ2YWx1ZSIsInZhbHVlUmVzb2x1dGlvbiIsInJlc29sdmVWYWx1ZSIsImFsbG93U2VsZkVkZ2UiLCJjYXNlUmVsYXRpb25zaGlwIiwiZmlsdGVyIiwiZXhwZWN0ZWQiXSwibWFwcGluZ3MiOiJ5UEFBQTs7QUFFQSxNQUFNQSxjQUFjLEdBQUc7QUFDckJDLEVBQUFBLFFBQVEsRUFBRSxD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cmV0ZURhdGFiYXNlV3JhcHBlci5qcydcbi8vIEZhbGxiYWNrIG5vZGUgZm9yIHVucmVzb2x2ZWQgcmVmZXJlbmNlIHJlcm91dGUuIFRoaXMgaXMgYW4gaW1wbGljaXQgbm9kZSwgdGhhdCBkb2Vzbid0IGFjdHVhbGx5IGV4aXN0IGluIHRoZSBncmFwaC5cbmNvbnN0IGVtcHR5U3RhZ2VOb2RlID0ge1xuICBpZGVudGl0eTogLTEsXG4gIGxhYmVsczogWydTdGFnZSddLFxuICBwcm9wZXJ0aWVzOiB7XG4gICAga2V5OiBudWxsLFxuICB9LFxufVxuXG4vLyBSZXNvbHV0aW9uIG9mIHJlZmVyZW5jZSBub2RlIHVzaW5nIGRpZmZlcmVudCBtZWNoYW5pc21zLlxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJlc29sdmVSZWZlcmVuY2UoeyB0YXJnZXROb2RlLCBncmFwaCwgdHJhdmVyc2VDYWxsQ29udGV4dCB9KSB7XG4gIGNvbnN0IHsgcmVmZXJlbmNlIH0gPSBhd2FpdCBncmFwaC5kYXRhYmFzZVdyYXBwZXIuZ2V0UmVmZXJlbmNlUmVzb2x1dGlvbkVsZW1lbnQoeyBjb25jcmV0ZURhdGFiYXNlOiBncmFwaC5kYXRhYmFzZSwgbm9kZUlEOiB0YXJnZXROb2RlLmlkZW50aXR5IH0pXG4gIGlmICghcmVmZXJlbmNlKSByZXR1cm5cblxuICAvLyBwcmV2ZW50IGNpcmN1bGFyIHRyYXZlcnNhbCwgaW4gY2FzZSBtdWx0aXBsZSB0eXBlcyBhcmUgdXNlZCBmb3IgdGhlIHNhbWUgbm9kZSBhbmQgdGhlIHJlZmVyZW5jZSBlZGdlIGlzIHNlbGYgZWRnZTpcbiAgaWYgKGlzU2VsZkVkZ2UocmVmZXJlbmNlKSkge1xuICAgIC8vIHdvcmthcm91bmQgaXMgdG8gcmVtb3ZlIHRoZSBSZXJvdXRlIHR5cGUgZnJvbSB0aGUgbGFiZWxzIGFycmF5LiBUT0RPOiBjb25zaWRlciBhbGxvd2luZyBhIHBhcmFtZXRlciB0aGF0IGNvbnRyb2xzIHdoaWNoIGVudHJ5cG9pbnQgbm9kZSBpbXBsZW1lbnRhdGlvbnMgYXJlIGlnbm9yZWQuXG4gICAgbGV0IGxhYmVsSW5kZXggPSByZWZlcmVuY2UuZGVzdGluYXRpb24ubGFiZWxzLmluZGV4T2YodGFyZ2V0Tm9kZS5lbnRyeXBvaW50Tm9kZVR5cGUpXG4gICAgcmVmZXJlbmNlLmRlc3RpbmF0aW9uLmxhYmVsc1tsYWJlbEluZGV4XSArPSBgLWlnbm9yZWAgLy8gaWdub3JlIG9uIG5leHQgdHJhdmVyc2FsIChrZWVwIHRoZSBlbnRyeSBmb3IgZGVidWdnaW5nIHB1cnBvc2VzKS5cbiAgfVxuXG4gIGxldCByZXNvbHZlZE5vZGVcbiAgc3dpdGNoIChyZWZlcmVuY2UuY29ubmVjdGlvbi5wcm9wZXJ0aWVzLnJlc29sdXRpb25JbXBsZW1lbnRhdGlvbikge1xuICAgIGNhc2UgJ3NlbGVjdGlvbic6XG4gICAgICByZXNvbHZlZE5vZGUgPSBhd2FpdCBncmFwaC50cmF2ZXJzZXJJbnN0cnVjdGlvbi5yZWZlcmVuY2VSZXNvbHV0aW9uLnNlbGVjdGlvblJlZmVyZW5jZVJlc29sdXRpb24oeyBncmFwaCwgdGFyZ2V0Tm9kZTogcmVmZXJlbmNlLmRlc3RpbmF0aW9uLCB0cmF2ZXJzZUNhbGxDb250ZXh0IH0pXG4gICAgICBicmVha1xuICAgIGNhc2UgJ25vZGUnOlxuICAgIGRlZmF1bHQ6XG4gICAgICByZXNvbHZlZE5vZGUgPSByZWZlcmVuY2UuZGVzdGluYXRpb25cbiAgICAgIGJyZWFrXG4gIH1cblxuICByZXR1cm4gcmVzb2x2ZWROb2RlXG59XG5cbi8qKlxuICogQ29udHJvbCBmbG93IHN0cnVjdHVyZSBzdXBwb3J0aW5nIGJpbmFyeSBzZWxlY2F0aW9uIChpZiBzdGF0ZW1lbnQpLCBpZiBlbHNlIGlmLCBzd2l0Y2ggY2FzZSAobXVsdGktd2F5IHNlbGVjdGlvbikuIEEgY29tYmluZWQgSWYgRWxzZSBhbmQgU3dpdGNoIENhc2UgY29uY2VwdHMuXG4gIFRPRE86IENvbnNpZGVyIHVzaW5nIFwiQ29tcGFyaXNvblwiIGFzIHRoZSBub2RlIGxhYmVsIGZvciBzZWxlY3Rpb24gZGVzdGluYXRpb25zLlxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VsZWN0aW9uUmVmZXJlbmNlUmVzb2x1dGlvbih7IGdyYXBoLCB0YXJnZXROb2RlLCB0cmF2ZXJzZUNhbGxDb250ZXh0IH0pIHtcbiAgbGV0IHJlc29sdmVkUmVmZXJlbmNlTm9kZVxuICBjb25zdCB7IHNlbGVjdEFycmF5LCBmYWxsYmFjazogZmFsbGJhY2tSZWxhdGlvbnNoaXAgfSA9IGF3YWl0IGdyYXBoLmRhdGFiYXNlV3JhcHBlci5nZXRTZWxlY3Rpb25FbGVtZW50KHsgY29uY3JldGVEYXRhYmFzZTogZ3JhcGguZGF0YWJhc2UsIG5vZGVJRDogdGFyZ2V0Tm9kZS5pZGVudGl0eSB9KVxuXG4gIGlmIChzZWxlY3RBcnJheSkge1xuICAgIHNlbGVjdEFycmF5LnNvcnQoXG4gICAgICAoZm9ybWVyLCBsYXR0ZXIpID0+IGZvcm1lci5jb25uZWN0aW9uLnByb3BlcnRpZXMub3JkZXIgLSBsYXR0ZXIuY29ubmVjdGlvbi5wcm9wZXJ0aWVzLm9yZGVyIHx8IGlzTmFOKGZvcm1lci5jb25uZWN0aW9uLnByb3BlcnRpZXMub3JkZXIpIC0gaXNOYU4obGF0dGVyLmNvbm5lY3Rpb24ucHJvcGVydGllcy5vcmRlciksXG4gICAgKSAvLyB1c2luZyBgb3JkZXJgIHByb3BlcnR5IC8vIEJ1bGsgYWN0aW9ucyBvbiBmb3JrcyAtIHNvcnQgZm9ya3NcblxuICAgIC8vIFRPRE86IHN1cHBvcnQgcGFyYWxsZWwgLyBwcm9taXNlLmFsbCBzZWxlY3Rpb24gLSB3aGVyZSB0aGUgZmlyc3Qgc2VsZWN0ZWQgd2lsbCBiZSByZXR1cm5lZC4gV2hlbiBTRUxFQ1QgaGFzIGFuIG9yZGVyIGl0IHdpbGwgYmUgY2hyb25vbG9naWNhbGx5IGV4ZWN1dGVkLCBidXQgdGhlIHNlbGVjdHMgdGhhdCBsYWNrIG9yZGVyIHByb3BlcnR5IHdpbGwgYmUgZXhlY3V0ZWQgd2l0aCBwcm9taXNlLmFsbFxuICAgIC8vIFRPRE86IFVzZSBzYW1lIGxvZ2ljIGluIHByb3BhZ2F0aW9uIGFzIHVzZWQgZm9yIFBvcnQgTkVYVCBub2Rlcy4gKGNocm9ub2xvZ2ljYWwsIHJhY2VGaXJzdFByb21pc2UsIGFsbFByb21pc2UsIGV0Yy4pXG4gICAgbGV0IGluZGV4ID0gMFxuICAgIHdoaWxlIChzZWxlY3RBcnJheS5sZW5ndGggPiBpbmRleCAmJiAhcmVzb2x2ZWRSZWZlcmVuY2VOb2RlKSB7XG4gICAgICByZXNvbHZlZFJlZmVyZW5jZU5vZGUgPSBhd2FpdCBncmFwaC50cmF2ZXJzZXJJbnN0cnVjdGlvbi5yZWZlcmVuY2VSZXNvbHV0aW9uLmNvbmRpdGlvblN3aXRjaFJlc29sdXRpb24oeyBncmFwaCwgdGFyZ2V0Tm9kZTogc2VsZWN0QXJyYXlbaW5kZXhdLmRlc3RpbmF0aW9uLCB0cmF2ZXJzZUNhbGxDb250ZXh0IH0pXG4gICAgICBpbmRleCsrXG4gICAgfVxuICB9XG5cbiAgLy8gSW1wb3J0YW50OiByZXJvdXRlIHJlc29sdXRpb24gbXVzdCByZXR1cm4gYSBub2RlIGV2ZW4gaWYgbm8gYWN0dWFsIG9uZSB3YXMgcmVzb2x2ZWQuIFRoaXMgd2lsbCBwcmV2ZW50IHJldHVybmluZyBhbiB1bmRlZmluZWQgdGhhdCB3aWxsIHRocm93IGR1cmluZyBhZ2dyZWdhdGlvbiBvZiByZXN1bHRzLiBJbnN0ZWFkIHJldHVybiBhIFN0YWdlIHRoYXQgd2lsbCBiZSBza2lwcGVkLlxuICByZXNvbHZlZFJlZmVyZW5jZU5vZGUgfHw9IGZhbGxiYWNrUmVsYXRpb25zaGlwPy5kZXN0aW5hdGlvbiB8fCBlbXB0eVN0YWdlTm9kZVxuICByZXR1cm4gcmVzb2x2ZWRSZWZlcmVuY2VOb2RlXG59XG5cbi8qKiByZXNvbHZlcyBWQUxVRSBhbmQgcGlja3MgdGhlIG1hdGNoaW5nIENBU0Ugbm9kZS5cbiAgKiBAcGFyYW0gdGFyZ2V0Tm9kZSBTdGFnZSBub2RlIHdpdGggVkFMVUUgY29ubmVjdGlvbiByZXByZXNlbnRpbmcgdGhlIGNvbmRpdGlvblxuXG4qL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNvbmRpdGlvblN3aXRjaFJlc29sdXRpb24oeyBncmFwaCwgdGFyZ2V0Tm9kZSwgdHJhdmVyc2VDYWxsQ29udGV4dCB9KSB7XG4gIGxldCBtYXRjaGluZ05vZGVcbiAgY29uc3QgeyBjYXNlQXJyYXkgfSA9IGF3YWl0IGdyYXBoLmRhdGFiYXNlV3JhcHBlci5nZXRDb25kaXRpb25Td2l0Y2hFbGVtZW50KHsgY29uY3JldGVEYXRhYmFzZTogZ3JhcGguZGF0YWJhc2UsIG5vZGVJRDogdGFyZ2V0Tm9kZS5pZGVudGl0eSB9KVxuICBsZXQgdmFsdWUgPSBhd2FpdCBncmFwaC50cmF2ZXJzZXJJbnN0cnVjdGlvbi52YWx1ZVJlc29sdXRpb24ucmVzb2x2ZVZhbHVlKHsgdGFyZ2V0Tm9kZTogdGFyZ2V0Tm9kZSwgZ3JhcGgsIHRyYXZlcnNlQ2FsbENvbnRleHQsIGFsbG93U2VsZkVkZ2U6IHRydWUgfSlcbiAgLy8gU3dpdGNoIGNhc2VzOiByZXR1cm4gZXZhbHVhdGlvbiBjb25maWd1cmF0aW9uXG4gIGlmIChjYXNlQXJyYXkpIHtcbiAgICAvLyBjb21wYXJlIGV4cGVjdGVkIHZhbHVlIHdpdGggcmVzdWx0XG4gICAgbGV0IGNhc2VSZWxhdGlvbnNoaXAgPSBjYXNlQXJyYXkuZmlsdGVyKGNhc2VSZWxhdGlvbnNoaXAgPT4gY2FzZVJlbGF0aW9uc2hpcC5jb25uZWN0aW9uLnByb3BlcnRpZXM/LmV4cGVjdGVkID09IHZhbHVlKVswXVxuICAgIG1hdGNoaW5nTm9kZSA9IGNhc2VSZWxhdGlvbnNoaXA/LmRlc3RpbmF0aW9uXG4gIH1cbiAgcmV0dXJuIG1hdGNoaW5nTm9kZSB8fCBudWxsXG59XG4iXX0=