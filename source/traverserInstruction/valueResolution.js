"use strict";var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports, "__esModule", { value: true });exports.resolveValue = resolveValue;exports.conditionSubgraphValueResolution = conditionSubgraphValueResolution;exports.conditionSubgraphWithNonBooleanValueResolution = conditionSubgraphWithNonBooleanValueResolution;var _concreteDatabaseWrapper = require("../dataModel/concreteDatabaseWrapper.js");
var _assert = _interopRequireDefault(require("assert"));



async function resolveValue({ targetNode, graph, traverseCallContext, allowSelfEdge = false }) {
  const value = await graph.databaseWrapper.getValueElement({ concreteDatabase: graph.database, nodeID: targetNode.identity });
  if (!value) return;

  let resolvedValue;

  switch (value.connection.properties.implementation) {
    case 'conditionSubgraph':
      if (!allowSelfEdge) (0, _assert.default)(!(0, _concreteDatabaseWrapper.isSelfEdge)(value), `â€¢ Self-edge for VALUE connection with "conditionSubgraph" implementation, currently not supported, as it causes infinite loop.`);
      resolvedValue = await graph.traverserInstruction.valueResolution.conditionSubgraphValueResolution({ value, graph, traverseCallContext });
      break;
    case 'properties':
      resolvedValue = value.source.properties;
      break;
    case 'node':
      resolvedValue = value.source;
      break;
    case 'valueProperty':
    default:
      resolvedValue = value.source.properties.value;
      break;}

  return resolvedValue;
}













async function conditionSubgraphValueResolution({ value, graph, traverseCallContext }) {
  let resolvedValue;


  let resultValueArray = await graph.traverse(





  {
    nodeInstance: value.source,
    implementationKey: {
      processNode: 'executeFunctionReference',
      traversalInterception: 'traverseThenProcessWithLogicalOperator',
      aggregator: 'ConditionAggregator' } },


  {
    traverseCallContext: {
      targetNode: traverseCallContext && traverseCallContext.targetNode || value.destination } });




  if (resultValueArray.length > 1) resolvedValue = resultValueArray.every(item => Boolean(item));else
  if (resultValueArray.length != 0) resolvedValue = resultValueArray[0];
  return resolvedValue;
}


async function conditionSubgraphWithNonBooleanValueResolution({ value, graph, traverseCallContext }) {}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NvdXJjZS90cmF2ZXJzZXJJbnN0cnVjdGlvbi92YWx1ZVJlc29sdXRpb24uanMiXSwibmFtZXMiOlsicmVzb2x2ZVZhbHVlIiwidGFyZ2V0Tm9kZSIsImdyYXBoIiwidHJhdmVyc2VDYWxsQ29udGV4dCIsImFsbG93U2VsZkVkZ2UiLCJ2YWx1ZSIsImRhdGFiYXNlV3JhcHBlciIsImdldFZhbHVlRWxlbWVudCIsImNvbmNyZXRlRGF0YWJhc2UiLCJkYXRhYmFzZSIsIm5vZGVJRCIsImlkZW50aXR5IiwicmVzb2x2ZWRWYWx1ZSIsImNvbm5lY3Rpb24iLCJwcm9wZXJ0aWVzIiwiaW1wbGVtZW50YXRpb24iLCJ0cmF2ZXJzZXJJbnN0cnVjdGlvbiIsInZhbHVlUmVzb2x1dGlvbiIsImNvbmRpdGlvblN1YmdyYXBoVmFsdWVSZXNvbHV0aW9uIiwic291cmNlIiwicmVzdWx0VmFsdWVBcnJheSIsInRyYXZlcnNlIiwibm9kZUluc3RhbmNlIiwiaW1wbGVtZW50YXRpb25LZXkiLCJwcm9jZXNzTm9kZSIsInRyYXZlcnNhbEludGVyY2VwdGlvbiIsImFnZ3JlZ2F0b3IiLCJkZXN0aW5hdGlvbiIsImxlbmd0aCIsImV2ZXJ5IiwiaXRlbSIsIkJvb2xlYW4iLCJjb25kaXRpb25TdWJncmFwaFdpdGhOb25Cb29sZWFuVmFsdWVSZXNvbHV0aW9uIl0sIm1hcHBpbmdzIjoid1hBQUE7QUFDQTs7OztBQUlPLGVBQWVBLFlBQWYsQ0FBNEIsRUFBRUMsVUFBRixFQUFjQyxLQUFkLEVBQXFCQyxtQkFBckIsRUFBMENDLGFBQWEsR0FBRyxLQUExRCxFQUE1QixFQUErRjtBQUNwRyxRQUFNQyxLQUFLLEdBQUcsTUFBTUgsS0FBSyxDQUFDSSxlQUFOLENBQXNCQyxlQUF0QixDQUFzQyxFQUFFQyxnQkFBZ0IsRUFBRU4sS0FBSyxDQUFDTyxRQUExQixFQUFvQ0MsTUFBTSxFQUFFVCxVQUFVLENBQUNVLFFBQXZELEVBQXRDLENBQXBCO0FBQ0EsTUFBSSxDQUFDTixLQUFMLEVBQVk7O0FBRVosTUFBSU8sYUFBSjs7QUFFQSxVQUFRUCxLQUFLLENBQUNRLFVBQU4sQ0FBaUJDLFVBQWpCLENBQTRCQyxjQUFwQztBQUNFLFNBQUssbUJBQUw7QUFDRSxVQUFJLENBQUNYLGFBQUwsRUFBb0IscUJBQU8sQ0FBQyx5Q0FBV0MsS0FBWCxDQUFSLEVBQTRCLGdJQUE1QjtBQUNwQk8sTUFBQUEsYUFBYSxHQUFHLE1BQU1WLEtBQUssQ0FBQ2Msb0JBQU4sQ0FBMkJDLGVBQTNCLENBQTJDQyxnQ0FBM0MsQ0FBNEUsRUFBRWIsS0FBRixFQUFTSCxLQUFULEVBQWdCQyxtQkFBaEIsRUFBNUUsQ0FBdEI7QUFDQTtBQUNGLFNBQUssWUFBTDtBQUNFUyxNQUFBQSxhQUFhLEdBQUdQLEtBQUssQ0FBQ2MsTUFBTixDQUFhTCxVQUE3QjtBQUNBO0FBQ0YsU0FBSyxNQUFMO0FBQ0VGLE1BQUFBLGFBQWEsR0FBR1AsS0FBSyxDQUFDYyxNQUF0QjtBQUNBO0FBQ0YsU0FBSyxlQUFMO0FBQ0E7QUFDRVAsTUFBQUEsYUFBYSxHQUFHUCxLQUFLLENBQUNjLE1BQU4sQ0FBYUwsVUFBYixDQUF3QlQsS0FBeEM7QUFDQSxZQWRKOztBQWdCQSxTQUFPTyxhQUFQO0FBQ0Q7Ozs7Ozs7Ozs7Ozs7O0FBY00sZUFBZU0sZ0NBQWYsQ0FBZ0QsRUFBRWIsS0FBRixFQUFTSCxLQUFULEVBQWdCQyxtQkFBaEIsRUFBaEQsRUFBdUY7QUFDNUYsTUFBSVMsYUFBSjs7O0FBR0EsTUFBSVEsZ0JBQWdCLEdBQUcsTUFBTWxCLEtBQUssQ0FBQ21CLFFBQU47Ozs7OztBQU0zQjtBQUNFQyxJQUFBQSxZQUFZLEVBQUVqQixLQUFLLENBQUNjLE1BRHRCO0FBRUVJLElBQUFBLGlCQUFpQixFQUFFO0FBQ2pCQyxNQUFBQSxXQUFXLEVBQUUsMEJBREk7QUFFakJDLE1BQUFBLHFCQUFxQixFQUFFLHdDQUZOO0FBR2pCQyxNQUFBQSxVQUFVLEVBQUUscUJBSEssRUFGckIsRUFOMkI7OztBQWMzQjtBQUNFdkIsSUFBQUEsbUJBQW1CLEVBQUU7QUFDbkJGLE1BQUFBLFVBQVUsRUFBR0UsbUJBQW1CLElBQUlBLG1CQUFtQixDQUFDRixVQUE1QyxJQUEyREksS0FBSyxDQUFDc0IsV0FEMUQsRUFEdkIsRUFkMkIsQ0FBN0I7Ozs7O0FBcUJBLE1BQUlQLGdCQUFnQixDQUFDUSxNQUFqQixHQUEwQixDQUE5QixFQUFpQ2hCLGFBQWEsR0FBR1EsZ0JBQWdCLENBQUNTLEtBQWpCLENBQXVCQyxJQUFJLElBQUlDLE9BQU8sQ0FBQ0QsSUFBRCxDQUF0QyxDQUFoQixDQUFqQztBQUNLLE1BQUlWLGdCQUFnQixDQUFDUSxNQUFqQixJQUEyQixDQUEvQixFQUFrQ2hCLGFBQWEsR0FBR1EsZ0JBQWdCLENBQUMsQ0FBRCxDQUFoQztBQUN2QyxTQUFPUixhQUFQO0FBQ0Q7OztBQUdNLGVBQWVvQiw4Q0FBZixDQUE4RCxFQUFFM0IsS0FBRixFQUFTSCxLQUFULEVBQWdCQyxtQkFBaEIsRUFBOUQsRUFBcUcsQ0FBRSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGlzU2VsZkVkZ2UgfSBmcm9tICcuLi9kYXRhTW9kZWwvY29uY3JldGVEYXRhYmFzZVdyYXBwZXIuanMnXG5pbXBvcnQgYXNzZXJ0IGZyb20gJ2Fzc2VydCdcblxuLy8gVE9ETzogTW92ZSBvdGhlciBub2RlIGluc3RydWN0aW9uIG91dHNpZGUgb2Ygbm9kZSB0eXBlIGZ1bmN0aW9ucywgdG8gbWFrZSBhIG1vcmUgbW9kdWxhciBpbnN0cnVjdGlvbiBmdW5jdGlvbnMuXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZXNvbHZlVmFsdWUoeyB0YXJnZXROb2RlLCBncmFwaCwgdHJhdmVyc2VDYWxsQ29udGV4dCwgYWxsb3dTZWxmRWRnZSA9IGZhbHNlIH0pIHtcbiAgY29uc3QgdmFsdWUgPSBhd2FpdCBncmFwaC5kYXRhYmFzZVdyYXBwZXIuZ2V0VmFsdWVFbGVtZW50KHsgY29uY3JldGVEYXRhYmFzZTogZ3JhcGguZGF0YWJhc2UsIG5vZGVJRDogdGFyZ2V0Tm9kZS5pZGVudGl0eSB9KVxuICBpZiAoIXZhbHVlKSByZXR1cm5cblxuICBsZXQgcmVzb2x2ZWRWYWx1ZVxuICAvKiBydW4gY29uZGl0aW9uIGNoZWNrIGFnYWluc3QgY29tcGFyaXNvbiB2YWx1ZS4gSGllcmFyY2h5IG9mIGNvbXBhcmlzb24gdmFsdWUgY2FsY3VsYXRpb246ICAgKi9cbiAgc3dpdGNoICh2YWx1ZS5jb25uZWN0aW9uLnByb3BlcnRpZXMuaW1wbGVtZW50YXRpb24pIHtcbiAgICBjYXNlICdjb25kaXRpb25TdWJncmFwaCc6XG4gICAgICBpZiAoIWFsbG93U2VsZkVkZ2UpIGFzc2VydCghaXNTZWxmRWRnZSh2YWx1ZSksIGDigKIgU2VsZi1lZGdlIGZvciBWQUxVRSBjb25uZWN0aW9uIHdpdGggXCJjb25kaXRpb25TdWJncmFwaFwiIGltcGxlbWVudGF0aW9uLCBjdXJyZW50bHkgbm90IHN1cHBvcnRlZCwgYXMgaXQgY2F1c2VzIGluZmluaXRlIGxvb3AuYCkgLy8gVE9ETzogZGVhbCB3aXRoIGNpcmN1bGFyIHRyYXZlcnNhbCBmb3IgdGhpcyB0eXBlLlxuICAgICAgcmVzb2x2ZWRWYWx1ZSA9IGF3YWl0IGdyYXBoLnRyYXZlcnNlckluc3RydWN0aW9uLnZhbHVlUmVzb2x1dGlvbi5jb25kaXRpb25TdWJncmFwaFZhbHVlUmVzb2x1dGlvbih7IHZhbHVlLCBncmFwaCwgdHJhdmVyc2VDYWxsQ29udGV4dCB9KVxuICAgICAgYnJlYWtcbiAgICBjYXNlICdwcm9wZXJ0aWVzJzpcbiAgICAgIHJlc29sdmVkVmFsdWUgPSB2YWx1ZS5zb3VyY2UucHJvcGVydGllc1xuICAgICAgYnJlYWtcbiAgICBjYXNlICdub2RlJzpcbiAgICAgIHJlc29sdmVkVmFsdWUgPSB2YWx1ZS5zb3VyY2VcbiAgICAgIGJyZWFrXG4gICAgY2FzZSAndmFsdWVQcm9wZXJ0eSc6XG4gICAgZGVmYXVsdDpcbiAgICAgIHJlc29sdmVkVmFsdWUgPSB2YWx1ZS5zb3VyY2UucHJvcGVydGllcy52YWx1ZVxuICAgICAgYnJlYWtcbiAgfVxuICByZXR1cm4gcmVzb2x2ZWRWYWx1ZVxufVxuXG4vKlxuICAgIF9fX18gICAgICAgICAgICAgICAgXyBfIF8gICBfICAgICAgICAgICAgIFxuICAgLyBfX198X19fICBfIF9fICAgX198IChfKSB8XyhfKSBfX18gIF8gX18gIFxuICB8IHwgICAvIF8gXFx8ICdfIFxcIC8gX2AgfCB8IF9ffCB8LyBfIFxcfCAnXyBcXCBcbiAgfCB8X198IChfKSB8IHwgfCB8IChffCB8IHwgfF98IHwgKF8pIHwgfCB8IHxcbiAgIFxcX19fX1xcX19fL3xffCB8X3xcXF9fLF98X3xcXF9ffF98XFxfX18vfF98IHxffFxuICAgU2VsZWN0aXZlIC8gQ29uZGl0aW9uYWxcbiovXG4vKipcbiAqIEByZXR1cm4ge05vZGUgT2JqZWN0fSAtIGEgbm9kZSBvYmplY3QgY29udGFpbmluZyBkYXRhLlxuIFRoZSBjb25kaXRpb24gc3ViZ3JhcGggcmV0dXJucyBhIGJvb2xlYW4gdmFsdWUuXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjb25kaXRpb25TdWJncmFwaFZhbHVlUmVzb2x1dGlvbih7IHZhbHVlLCBncmFwaCwgdHJhdmVyc2VDYWxsQ29udGV4dCB9KSB7XG4gIGxldCByZXNvbHZlZFZhbHVlXG4gIC8vIFJ1biByZWZlcmVuY2Ugbm9kZSBpbiBhIHNlcGFyYXRlIHRyYXZlcnNhbCByZWN1cnNpdmUgc2NvcGVzLCBhbmQgcmV0dXJuIHJlc3VsdC5cbiAgLy8gdHJhdmVyc2UgdGhlIGRlc3RpbmF0aW9uIGFuZCBleHRyYWN0IG5vZGUgZnJvbSB0aGUgcmVzdWx0IHZhbHVlLlxuICBsZXQgcmVzdWx0VmFsdWVBcnJheSA9IGF3YWl0IGdyYXBoLnRyYXZlcnNlKFxuICAgIC8qIFRPRE86IE5vdGU6IHRoaXMgaXMgYSBxdWljayBpbXBsZW1lbnRhdGlvbiBiZWNhdXNlIGRpZ2dpbmcgaW50byB0aGUgY29yZSBjb2RlIGlzIHRpbWUgY29uc3VtaW5nLCB0aGUgZGlmZmVyZW50IGNvbmNlcHRzIHVzZWQgaW4gaGVyZSBjb3VsZCBiZSBpbXByb3ZlZCBhbmQgYnVpbHQgdXBvbiBvdGhlciBhbHJlYWR5IGV4aXN0aW5nIGNvbmNlcHRzOiBcbiAgICAgICAgICAgVE9ETzogY3JlYXRlIGFuIGluc3RhbmNlIGdyYXBoIGZyb20gdGhlIGN1cnJlbnQgZ3JhcGgsIHRvIGFsbG93IHBhc3NpbmcgYWRkaXRpb25hbCBjb250ZXh0IHBhcmFtZXRycy5cbiAgICAgICAgICAgICAgIOKAoiAndHJhdmVyc2FsQ2FsbENvbnRleHQnIC0gdGhlIDJuZCBwcm92aWRlZCBhcmd1bWVudCBjb3VsZCBiZSBpbnN0ZWFkIGFwcGxpZWQgYXMgYSByZWd1bGFyIENvbnRleHQgc3BlY2lmaWMgZm9yIHRoZSBjYWxsLCBieSBjcmVhdGluZyBhIG5ldyBncmFwaCBjaGFpbiB3aXRoIGl0J3MgdW5pcXVlIGNvbnRleHQsIGluIGFkZGl0aW9uIHRvIHRoZSBhbHJlYWR5IGV4aXN0aW5nIGNvbnRleHQgaW5zdGFuY2UuXG4gICAgICAgICAgIHdhcyB0aGlzIGRvbmUgPyB+fuKAoiBDb25kaXRpb25BZ2dyZWdhdG9yICYgdHJhdmVyc2VUaGVuUHJvY2Vzc1dpdGhMb2dpY2FsT3BlcmF0b3IgaW1wbGVtZW50YXRpb25zIGNvdWxkIGJlIGludGVncmF0dGVkIGludG8gdGhlIG90aGVyIGltcGxlbWVudGF0aW9ucy5+flxuICAgICAgICAgKi9cbiAgICB7XG4gICAgICBub2RlSW5zdGFuY2U6IHZhbHVlLnNvdXJjZSxcbiAgICAgIGltcGxlbWVudGF0aW9uS2V5OiB7XG4gICAgICAgIHByb2Nlc3NOb2RlOiAnZXhlY3V0ZUZ1bmN0aW9uUmVmZXJlbmNlJywgLy8gZGVmYXVsdCBpbXBsZW1lbnRhdGlvbiBmb3IgcHJvY2Vzc2luZyBzdGFnZXMgaW4gY29uZGl0aW9uIGdyYXBoLlxuICAgICAgICB0cmF2ZXJzYWxJbnRlcmNlcHRpb246ICd0cmF2ZXJzZVRoZW5Qcm9jZXNzV2l0aExvZ2ljYWxPcGVyYXRvcicsXG4gICAgICAgIGFnZ3JlZ2F0b3I6ICdDb25kaXRpb25BZ2dyZWdhdG9yJyxcbiAgICAgIH0sXG4gICAgfSxcbiAgICB7XG4gICAgICB0cmF2ZXJzZUNhbGxDb250ZXh0OiB7XG4gICAgICAgIHRhcmdldE5vZGU6ICh0cmF2ZXJzZUNhbGxDb250ZXh0ICYmIHRyYXZlcnNlQ2FsbENvbnRleHQudGFyZ2V0Tm9kZSkgfHwgdmFsdWUuZGVzdGluYXRpb24sIC8vIHBhc3MgdGhlIG5vZGUgcmVxdWVzdGluZyB0aGUgcmVzb2x1dGlvbiBvZiB0aGUgcmVyb3V0ZSBub2RlIGlmIGl0IGV4aXN0cywgb3IgdGhlIHJlcm91dGUgaXRzZWxmIGluIGNhc2UgY2FsbGVkIGFzIHJvb3QgbGV2ZWwgaW4gdGhlIHRyYXZlcnNhbC5cbiAgICAgIH0sXG4gICAgfSxcbiAgKSAvLyB0cmF2ZXJzZSBzdWJncmFwaCB0byByZXRyaWV2ZSBhIHJlZmVyZW5jZWQgbm9kZS5cblxuICBpZiAocmVzdWx0VmFsdWVBcnJheS5sZW5ndGggPiAxKSByZXNvbHZlZFZhbHVlID0gcmVzdWx0VmFsdWVBcnJheS5ldmVyeShpdGVtID0+IEJvb2xlYW4oaXRlbSkpXG4gIGVsc2UgaWYgKHJlc3VsdFZhbHVlQXJyYXkubGVuZ3RoICE9IDApIHJlc29sdmVkVmFsdWUgPSByZXN1bHRWYWx1ZUFycmF5WzBdXG4gIHJldHVybiByZXNvbHZlZFZhbHVlXG59XG5cbi8vIFRPRE86IGNvbmRpdGlvbiBzdWJncmFwaCB0aGF0IHJldHVybnMgbm9uLWJvb2xlYW4sIGZ1bmN0aW9ucyBmb3IgbWFraW5nIGNvbXBsZXggY29uZGl0aW9uIGNoZWNrcy5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjb25kaXRpb25TdWJncmFwaFdpdGhOb25Cb29sZWFuVmFsdWVSZXNvbHV0aW9uKHsgdmFsdWUsIGdyYXBoLCB0cmF2ZXJzZUNhbGxDb250ZXh0IH0pIHt9XG4iXX0=